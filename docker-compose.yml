version: '3.8'

services:
  crowd-counter:
    image: cwhitio/crowd-counter:v3.0
    container_name: crowd-counter-app
    restart: unless-stopped
    
    # Environment variables - override defaults from Dockerfile
    environment:
      # PTZOptics Camera Configuration
      - CAMERA_IP=192.168.1.100
      - CAMERA_USER=username  
      - CAMERA_PASS=password
      
      # YOLO Model Configuration
      - MODEL_PATH=models/best.pt
      - INFER_CONF=0.10
      - INFER_IOU=0.30
      - CLUSTER_EPS=15
      - MIN_CLUSTER_SIZE=1000
      
      # Processing Configuration
      - BATCH_SIZE=4
      - NUM_WORKERS=4
      
      # Email Configuration
      - EMAIL_SENDER=no-reply@example.org
      - EMAIL_RECEIVER=user@example.org
      - EMAIL_API=your_api_key_here
      
      # PostgreSQL Database Configuration
      - DB_HOST=192.168.96.138
      - DB_PORT=5432
      - DB_NAME=blackhawk_analytics
      - DB_USER=postgres
      - DB_PASS=your_database_password
      
      # API Configuration
      - API_PORT=8000
      - API_DEBUG=false
    
    # Alternative: Load from .env file (uncomment to use)
    env_file:
      - .env
    
    # Volumes to persist data and access host files
    volumes:
      - ./data:/app/data
      - crowd-counter-output:/app/output  # Named volume for persistent storage
      - ./models:/app/models
    
    # Network configuration if needed
    # networks:
    #   - camera_network
    
# Port mapping for API
    ports:
      - "8000:8000"

# Named volumes for persistent data
volumes:
  crowd-counter-output:
    driver: local

# networks:
#   camera_network:
#     driver: bridge